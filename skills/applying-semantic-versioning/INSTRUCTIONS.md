# Applying Semantic Versioning

## バージョン形式

```
MAJOR.MINOR.PATCH[-prerelease][+build]
```

## 判断フロー

| 変更内容 | バージョン | 根拠 |
|---------|-----------|------|
| 後方互換性のないAPI変更 | **MAJOR** | 既存コードが壊れる |
| 後方互換性のある機能追加 | **MINOR** | 既存コードに影響なし |
| 後方互換性のあるバグ修正 | **PATCH** | 動作の修正のみ |
| 内部リファクタリング | **PATCH** | 公開APIに変化なし |
| 廃止予定機能の宣言 | **MINOR** | 機能追加扱い |

## 仕様の核心ルール

- パブリックAPIを明確に宣言すること
- X.Y.Z形式: 非負整数・先頭ゼロ禁止（例: `01.2.3` は無効）
- リリース済みバージョンのコンテンツ変更禁止（変更が必要なら新バージョン）
- **MAJOR 0**（0.y.z）は初期開発フェーズ: いつでも破壊的変更可
- **1.0.0** でパブリックAPIを確定
- バージョン増加時の下位リセット: MAJOR増加 → MINOR・PATCHを0にリセット、MINOR増加 → PATCHを0にリセット

## プレリリースバージョン

ハイフン + ドット区切り識別子: `1.0.0-alpha.1`

- 使用可能文字: ASCII英数字とハイフン `[0-9A-Za-z-]`
- 数値識別子は先頭ゼロ禁止
- 通常版より低い優先度（`1.0.0-alpha < 1.0.0`）

## ビルドメタデータ

プラス記号 + ドット区切り: `1.0.0+20240101`

- 優先度判定では**無視される**
- ビルド情報の付与のみに使用

## 優先度比較

左→右: **MAJOR → MINOR → PATCH → prerelease**

| ルール | 説明 |
|--------|------|
| 数値識別子 | 数値として比較（`2 < 10`） |
| 英数字識別子 | 辞書順比較 |
| 数値 vs 英数字 | 数値 < 英数字 |
| フィールド数 | 少ない方が低い優先度 |

優先度例:
```
1.0.0-alpha < 1.0.0-alpha.1 < 1.0.0-alpha.beta < 1.0.0-beta < 1.0.0-beta.2 < 1.0.0-beta.11 < 1.0.0-rc.1 < 1.0.0
```

## エコシステム別バージョン範囲指定

| 表記 | npm | pip | 意味 |
|------|-----|-----|------|
| 完全固定 | `1.2.3` | `==1.2.3` | 正確なバージョンのみ |
| パッチ許容 | `~1.2.0` | `~=1.2.0` | 1.2.x のみ |
| マイナー許容 | `^1.0.0` | `>=1.0,<2.0` | 1.x.x |
| 以上 | `>=1.0.0` | `>=1.0.0` | 1.0.0以上すべて |

## よくある誤り

| 誤り | 正しい対応 |
|------|-----------|
| 0.x.y を安定版として公開・宣伝する | MAJOR 0は開発版。安定版は1.0.0から |
| バグ修正なら安全と過信する | ハイラムの法則: 観察可能な挙動に依存するユーザーが必ずいる |
| 「v」接頭辞をSemVerの一部と誤認 | `v1.2.3` の「v」はSemVer仕様外（慣習的な表記） |
| 非互換変更をMINORでリリースする | 既存コードが壊れる変更は必ずMAJOR |
| MAJORアップをためらいPATCH/MINORに詰め込む | ユーザーへの正直な情報提供がSemVerの目的 |

## 検証用正規表現

```
^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
```

## 関連スキル

- `analyzing-software-tradeoffs`: APIバージョニング戦略のトレードオフ分析（互換性維持コスト vs 破壊的変更のコスト）
- `writing-conventional-commits`: コミットメッセージフォーマット（`fix:` → PATCH, `feat:` → MINOR, `BREAKING CHANGE` → MAJOR）
