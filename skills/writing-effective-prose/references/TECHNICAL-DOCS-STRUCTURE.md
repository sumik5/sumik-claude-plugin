# 文章・ドキュメント構造

効果的な技術文書の構造化手法とベストプラクティスを解説します。

## 🎯 文の構造原則

### 1. 文の長さ

**基本ルール**: 一文は50文字以内を目標に

```markdown
✅ 適切な長さ（50文字以内）
この関数は配列をソートします。計算量はO(n log n)です。

❌ 長すぎる（100文字超）
この関数は配列をソートする機能を提供しており、内部的にはクイックソートアルゴリズムを使用しているため計算量はO(n log n)となります。
```

**改善テクニック**:
- 長文を2-3文に分割
- 箇条書きの活用
- 接続詞の削減

---

### 2. 一文一義の原則

**基本ルール**: 一つの文には一つの主要なアイデアのみ

```markdown
✅ 一文一義
このメソッドはユーザーを作成します。
作成後、確認メールが送信されます。
ログには作成日時が記録されます。

❌ 複数の意味を含む
このメソッドはユーザーを作成し、確認メールを送信し、ログに記録します。
```

**分割の基準**:
- 「〜して、」「〜し、」が2回以上 → 分割
- 異なる動作・状態を説明 → 分割
- 因果関係が複雑 → 分割

---

### 3. 能動態の使用

**基本ルール**: 主語を明確にして能動態で書く

| 受動的表現 | 能動的表現 | 改善効果 |
|-----------|-----------|---------|
| 処理が行われます | システムが処理します | 主語が明確 |
| データの変更を行う | データを変更する | 直接的な動作 |
| によって実行される | ○○が実行する | 行為者が明確 |
| 送信される | サーバーが送信する | 責任の所在が明確 |

```markdown
✅ 能動態（主語が明確）
システムがデータを処理します。
APIサーバーがリクエストを検証します。
ユーザーが設定を変更できます。

❌ 受動態（主語が不明確）
データの処理が行われます。
リクエストの検証が実施されます。
設定の変更が可能です。
```

---

## 📄 ドキュメント構造パターン

### README構造の標準パターン

```markdown
# プロジェクト名

## 概要
プロジェクトの目的を1-2文で説明
- 何を解決するか
- 主要な価値は何か

## 主な機能
- 機能1: 具体的な説明
- 機能2: 具体的な説明
- 機能3: 具体的な説明

## 環境要件
- Node.js 18.0.0以上
- PostgreSQL 14以上
- Redis 7.0以上（オプション）

## セットアップ

### 1. リポジトリのクローン
```bash
git clone https://github.com/user/repo.git
cd repo
```

### 2. 依存関係のインストール
```bash
npm install
```

### 3. 環境変数の設定
```bash
cp .env.example .env
# .envファイルを編集してAPIキーを設定
```

### 4. データベースのマイグレーション
```bash
npm run migrate
```

### 5. 開発サーバーの起動
```bash
npm run dev
```

### 6. 動作確認
ブラウザで http://localhost:3000 を開く

## 使用方法

### 基本的な使用例
```typescript
import { createUser } from './lib/user'

const user = await createUser({
  name: '山田太郎',
  email: 'yamada@example.com'
})
```

### 高度な使用例
（必要に応じて追加）

## API仕様

### エンドポイント一覧
| メソッド | パス | 説明 |
|---------|------|------|
| GET | /api/users | ユーザー一覧取得 |
| POST | /api/users | ユーザー作成 |
| GET | /api/users/:id | ユーザー詳細取得 |

### レスポンス例
```json
{
  "id": "123",
  "name": "山田太郎",
  "email": "yamada@example.com",
  "createdAt": "2024-01-01T00:00:00Z"
}
```

## テスト

### テストの実行
```bash
npm test
```

### カバレッジの確認
```bash
npm run test:coverage
```

## デプロイ

### 本番環境へのデプロイ
```bash
npm run build
npm run deploy
```

## トラブルシューティング

### よくある問題

**Q: npm installでエラーが発生する**
A: Node.jsのバージョンを確認してください。18.0.0以上が必要です。

**Q: データベース接続エラー**
A: .envファイルのDATABASE_URLが正しく設定されているか確認してください。

## ライセンス
MIT License

## コントリビューション
Pull Requestを歓迎します。大きな変更の場合は、まずIssueで議論してください。
```

---

## 💬 コードコメントのベストプラクティス

### 1. 「なぜ」を説明する

```typescript
// ✅ 良いコメント: 「なぜ」を説明
// ユーザー体験向上のため、初回ロード時のみキャッシュを使用
const shouldUseCache = isFirstLoad

// ❌ 悪いコメント: コードの繰り返し
// iを1ずつ増やす
i++
```

### 2. 複雑なロジックの説明

```typescript
/**
 * ユーザーの権限レベルを計算
 *
 * アルゴリズム:
 * 1. 基本権限（role）を取得
 * 2. グループ権限をマージ
 * 3. 個別付与権限を追加
 * 4. 拒否権限を除外
 *
 * @param userId - ユーザーID
 * @returns 最終的な権限セット
 */
function calculatePermissions(userId: string): Set<Permission> {
  // 実装
}
```

### 3. 警告とTODO

```typescript
// ⚠️ 警告: このメソッドは非推奨です。代わりにnewMethodを使用してください
// @deprecated v2.0.0以降
function oldMethod() {
  // ...
}

// TODO: パフォーマンス最適化 - キャッシング実装
// Issue: #123
function fetchData() {
  // ...
}
```

### 4. コメント不要のケース

```typescript
// ❌ 不要なコメント
// ユーザー名を取得
const userName = user.name

// ✅ 明確な変数名でコメント不要
const userName = user.name
```

---

## 📊 リストと表の使い分け

### 箇条書き（順序なし）

**使用場面**: 順序が重要でない項目のリスト

```markdown
## 主な機能
- ユーザー認証
- データ管理
- レポート生成
```

### 番号付きリスト（順序あり）

**使用場面**: 手順や優先順位がある項目

```markdown
## セットアップ手順
1. リポジトリをクローン
2. 依存関係をインストール
3. 環境変数を設定
4. サーバーを起動
```

### 表

**使用場面**: 比較や構造化データの表示

```markdown
| 項目 | 開発環境 | 本番環境 |
|------|---------|---------|
| Node.js | 18.x | 18.x |
| DB | PostgreSQL | PostgreSQL |
| キャッシュ | - | Redis |
```

---

## 🎨 見出しの階層構造

### 見出しレベルの使い分け

```markdown
# H1: ドキュメントタイトル（1つのみ）

## H2: 主要セクション
メインセクションの区切り

### H3: サブセクション
H2の詳細説明

#### H4: 詳細項目
H3のさらなる詳細

##### H5以降は使用を避ける
構造が複雑すぎる場合は文書を分割
```

### 階層構造の例

```markdown
# API仕様書

## 認証

### トークン取得
- エンドポイント
- リクエスト形式
- レスポンス形式

### トークン更新
- エンドポイント
- リクエスト形式
- レスポンス形式

## ユーザー管理

### ユーザー一覧取得
- エンドポイント
- クエリパラメータ
- レスポンス形式
```

---

## 📝 段落構成のパターン

### BLOT（Bottom Line On Top）

**結論を先に述べる**

```markdown
✅ 結論先行
このライブラリはバンドルサイズを70%削減できます。
従来の実装では150KBでしたが、このライブラリを使用すると45KBになります。
初回ロード時間も2.5秒から0.8秒に短縮されます。

❌ 結論が最後
従来の実装では150KBでしたが、新しいライブラリを使用すると45KBになります。
初回ロード時間も2.5秒から0.8秒に短縮されます。
つまり、バンドルサイズを70%削減できます。
```

### トピックセンテンス

**段落の最初に主題を示す**

```markdown
✅ トピックセンテンスあり
キャッシング戦略には3つの選択肢があります。
1つ目はメモリキャッシュで、最も高速ですが容量制限があります。
2つ目はRedisで、永続化と分散環境に適しています。
3つ目はCDNキャッシュで、静的コンテンツに最適です。

❌ トピックセンテンスなし
メモリキャッシュは最も高速ですが容量制限があります。
Redisは永続化と分散環境に適しています。
CDNキャッシュは静的コンテンツに最適です。
```

---

## 🔗 クロスリファレンス

### 他セクションへの参照

```markdown
詳細な設定方法については、[環境構築](#環境構築)セクションを参照してください。

7つのC原則の詳細は [PRINCIPLES.md](PRINCIPLES.md) を参照してください。
```

### 外部リソースへのリンク

```markdown
- [公式ドキュメント](https://example.com/docs)
- [API リファレンス](https://example.com/api)
- [GitHub リポジトリ](https://github.com/user/repo)
```

---

## 📋 チェックリスト

文書構造の確認項目：

- [ ] 見出し階層は適切か（H1は1つ、H2-H4で構造化）
- [ ] 一文の長さは50文字以内か
- [ ] 一文一義になっているか
- [ ] 能動態を使用しているか
- [ ] 箇条書きと表を適切に使い分けているか
- [ ] トピックセンテンスがあるか
- [ ] クロスリファレンスが機能するか
- [ ] コードブロックに言語指定があるか

## 関連セクション

- [PRINCIPLES.md](PRINCIPLES.md): 7つのC原則
- [REPORTS.md](REPORTS.md): 報告書での構造適用
- [ANTI-PATTERNS.md](ANTI-PATTERNS.md): 構造上の誤り
