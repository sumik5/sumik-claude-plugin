# AI活用テストテクニック集（AI-TEST-TECHNIQUES.md）

具体的なAI活用テストテクニックとパターン集。

---

## TDD × AI ペアリング

### Red/Green/RefactorサイクルでのAI活用

#### Red前（設計フェーズ）

**要件の曖昧さをAIで質問リスト化**

```
以下の要件を分析し、実装前に明確にすべき質問のリストを作成してください:

要件:
「ユーザーはファイルをアップロードできる」

観点:
- ファイルサイズ制限
- 許可されるファイル形式
- 同時アップロード数
- エラーハンドリング
```

**品質特性を指定したリスク分析**

品質特性（正確性、一貫性、セキュリティ、パフォーマンス、可用性等）を明示して分析を依頼:

```
以下の認証機能について、セキュリティとパフォーマンスの観点でリスクを分析してください:

機能: JWT認証
- トークン有効期限: 1時間
- リフレッシュトークン機能あり
- ログイン失敗時のロックアウト機能

出力形式:
| リスク | 影響 | 対策案 |
```

#### Redフェーズ（テスト作成）

**AIコード補完でテストコード高速記述**

人間がテスト意図を主導し、AIがボイラープレート生成を加速:

```typescript
// 人間: テスト意図を記述
describe('User registration', () => {
  it('should reject invalid email format', () => {
    // AI: アレンジ、アクト、アサートの骨組みを補完
  });
});
```

**重要**: AIが主導する「テスト生成」ではなく、**人間が主導するTDDをAIが加速する**アプローチ。

#### Greenフェーズ（実装）

AIコード補完で最小限の実装を高速化:

```typescript
// 人間: 関数シグネチャを記述
function validateEmail(email: string): boolean {
  // AI: 実装パターンを補完（正規表現、検証ロジック）
}
```

#### Refactorフェーズ

AIにリファクタリング案を提案させ、人間が判断:

```
以下のコードを、単一責任原則に従ってリファクタリングしてください:

[コードを貼り付け]

制約:
- 既存のテストが通ること
- 複雑度を下げること
```

### コードレビューでのAI活用

品質特性を明示したプロンプトで分析:

```
以下のコードを正確性（Correctness）と一貫性（Consistency）の観点でレビューしてください:

[コードを貼り付け]

観点:
- エッジケース処理の漏れ
- データ型の一貫性
- エラーハンドリングの網羅性
```

---

## テスト計画とリスク分析

### リスク駆動テスト計画

テスト計画の核心は**リスクの特定と緩和**。

#### モデル活用パターン

1. **システムの視覚モデルを作成** - フローチャート、状態遷移図、データフロー図等
2. **モデルの各部分について具体的なプロンプトを構築**

例: ログインフローの状態遷移図を作成した後:

```
以下の状態遷移について、セキュリティリスクを分析してください:

状態: 「ログイン試行中」→「ログイン失敗」
遷移条件: パスワード不一致

リスク観点:
- ブルートフォース攻撃
- タイミング攻撃
- ユーザー列挙攻撃
```

### LLMをリスク提案者として活用

**3ステッププロセス**:

1. **人間がリスクを特定** - 経験・知識に基づく初期リスクリスト作成
2. **LLMに拡張を依頼**

```
以下のリスクリストを分析し、見落としている可能性のあるリスクを提案してください:

既存リスク:
- SQLインジェクション
- CSRF
- XSS

対象: Webアプリケーションのユーザー登録機能
```

3. **提案を批判的に評価** - 有用なものだけ採用、無関係な提案は却下

### 複数モデリング手法の活用

異なるモデリング手法でLLMに分析させることで、多角的な視点を得る:

```
以下の機能について、3つの異なる視点で分析してください:

機能: オンライン決済処理

1. データフロー視点: データがどこから来て、どこへ行くか
2. 状態遷移視点: 決済プロセスの状態とその遷移
3. ユーザーストーリーマッピング視点: ユーザーの行動フローと期待

各視点から潜在的な問題点を特定してください。
```

### 弱いプロンプト vs 強いプロンプト

| 弱いプロンプト | 問題 | 強いプロンプト | 改善点 |
|--------------|------|---------------|--------|
| 「ファイルアップロードのテストを作成して」 | 汎用的で使えない | 「最大ファイルサイズ10MB、許可形式はJPG/PNG、同時アップロード3ファイルまでの制約でテストケースを生成」 | 具体的な仕様・制約を含む |

核心: **具体的なコンテキスト、仕様、制約を含めるほど、AIの出力品質が向上**。

---

## テストデータ生成パターン

### パターン1: 基本データ生成

構造化プロンプトでJSON/CSVデータを生成:

```
あなたはJSONデータジェネレーターです。以下のルールに従って5つのJSONオブジェクトを配列で生成してください。
出力前に、5つのオブジェクトが作成されていることを確認してください。

ルール:
* 各パラメータは % 記号で識別
* 各列は キー名 | データ型 | オプション の順で記述

データ定義:
% name | string | ランダムな人名
% type | string | 'single' または 'double'
% count | integer | 1 から 6
% active | boolean | true または false

出力形式: JSON配列
```

### パターン2: 形式変換

既存データを別形式に変換:

**JSON → SQL INSERT文**

```
以下のJSONデータをSQL INSERT文に変換してください:

テーブル名: users
JSON:
[
  {"id": 1, "name": "Alice", "email": "alice@example.com"},
  {"id": 2, "name": "Bob", "email": "bob@example.com"}
]

出力形式: 実行可能なSQL INSERT文
```

**OpenAPI/XSD仕様に基づくデータ生成**

```
以下のOpenAPI仕様に厳密に準拠するテストデータを5パターン生成してください:

###OpenAPI Specification
openapi: 3.0.0
paths:
  /users:
    post:
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
###

制約:
- emailは有効な形式
- passwordは8文字以上
- 必須フィールドをすべて含む
```

### パターン3: 関連データ生成

SQLの CREATE TABLE 文をプロンプトに含め、テーブル間の関係性を保った一貫性のあるテストデータを生成:

```
以下のテーブル定義に基づいて、関連性のあるテストデータを生成してください:

###Schema
CREATE TABLE users (
  id INT PRIMARY KEY,
  name VARCHAR(100)
);

CREATE TABLE orders (
  id INT PRIMARY KEY,
  user_id INT REFERENCES users(id),
  amount DECIMAL(10, 2)
);
###

要件:
- 3人のユーザー
- 各ユーザーに1-3件の注文
- user_idの整合性を保つ

出力形式: SQL INSERT文
```

---

## UI自動化でのAI活用

### アンチパターン: テスト全体の丸投げ

```
❌ 悪い例:
「このWebアプリケーションのSeleniumテストを丸ごと生成して」
```

**問題**: プロジェクトコンテキスト不足で大幅な手直しが必要。

### 推奨パターン: コンポーネント単位での活用

#### 1. Page Object生成

HTMLソースを提供 → セレクタとメソッドを生成:

```
以下のHTMLからPage Objectクラスを生成してください:

###HTML
<form id="login-form">
  <input id="email" type="email" name="email" />
  <input id="password" type="password" name="password" />
  <button id="submit">Login</button>
</form>
###

要件:
- クラス名: LoginPage
- メソッド: fillEmail(), fillPassword(), clickSubmit()
- セレクタ: id属性を使用
- 言語: TypeScript + Playwright
```

#### 2. テストデータ部分のみ生成

```
以下のユーザー登録フォームのテストデータを10パターン生成してください:

フィールド:
- name: 3-50文字
- email: 有効なメール形式
- age: 18-120の整数

パターン:
- 正常系: 5パターン
- 境界値: 3パターン
- 異常系: 2パターン

出力形式: JSON配列
```

#### 3. アサーション部分の提案

```
以下のテストシナリオに対して、適切なアサーションを提案してください:

シナリオ: ユーザーがログインに成功した後
現在の実装: ダッシュボードページに遷移

提案すべきアサーション:
- URL検証
- UI要素の表示確認
- ユーザー情報の表示確認
```

#### 4. 既存コードの改善提案

```
以下のE2Eテストコードを、状態管理層を分離して改善してください:

[既存コードを貼り付け]

要件:
- Page Objectパターンを適用
- テストロジックとUI操作を分離
- 再利用性を高める
```

### 核心原則

**自動化プロセスの全体をAIに任せるのではなく、特定のステップでAIを活用する。**

---

## 探索的テストでのAI活用

### チャーター生成支援

**テンプレート**: `Explore <対象> With <リソース> To discover <情報>`

#### リスクリストからチャーター生成

```
以下のリスクリストに基づいて、探索的テストのチャーター（30分セッション）を5つ生成してください:

リスク:
- ファイルアップロードのサイズ制限
- 同時アップロード時の競合
- 不正なファイル形式の処理

テンプレート: Explore <対象> With <リソース> To discover <情報>
```

#### 機能的固定観念の克服

AIの異なる視点を活用して、人間が見落としがちな観点を発見:

```
以下の機能について、通常のテストでは見落とされがちな観点を提案してください:

機能: ショッピングカート

通常の観点:
- 商品追加
- 数量変更
- 削除

追加すべき観点を提案してください。
```

### セッション中の活用

#### 1. コード理解

```
以下のコードスニペットを自然言語で説明してください:

[コードを貼り付け]

対象読者: テスト担当者（開発者ではない）
```

#### 2. テストデータ準備

```
探索的テストセッション用に、以下の条件を満たすユーザーアカウントデータを5パターン生成してください:

セッション目標: 権限管理機能の探索
条件:
- 管理者: 1アカウント
- 編集者: 2アカウント
- 閲覧者: 2アカウント

出力形式: CSV
```

#### 3. ヒューリスティック × LLM

テスト観点リスト（SFDPOT等）をLLMに渡してテストアイデア生成:

```
以下のヒューリスティックを使って、検索機能のテストアイデアを生成してください:

ヒューリスティック: SFDPOT
- Structure（構造）
- Function（機能）
- Data（データ）
- Platform（プラットフォーム）
- Operations（操作）
- Time（時間）

機能: キーワード検索
```

#### 4. バグ調査

```
以下のコードスニペットを分析し、潜在的な問題箇所を特定してください:

[コードを貼り付け]

観点:
- Null/undefined処理
- 境界値処理
- エラーハンドリング
```

### レポート支援

生のテストノート → 構造化されたテストストーリー/レポートに変換:

```
以下の探索的テストセッションのノートを、構造化されたテストレポートに変換してください:

###テストノート
- ログイン後にダッシュボードが表示された
- サイドバーのメニューをクリック→ページ遷移が遅い（3秒）
- 検索ボックスに日本語入力→結果が文字化け
- ...
###

出力形式:
- セッション概要
- 発見した問題（重要度順）
- 未解決の疑問
- 次のセッションへの提案
```

### 注意事項

**探索的テストの核心（観察・分析・判断）はAIに委譲しない。AIは支援ツール。**

人間が主導すべきこと:
- テスト目標の設定
- 観察と気づき
- 重要度の判断
- 次のアクションの決定

---

## AIエージェントとテスト（概要）

### エージェントの4特性

1. **ゴール駆動**: 目標を受け取り、達成のための計画を立てる
2. **知覚（外部連携）**: ツール・API・ファイルシステムと連携
3. **自律的判断**: 次のアクションを自己決定
4. **適応学習**: 過去の結果から戦略を調整

### テスト活用例

#### テストデータ管理エージェント

```
ゴール: テスト実行前に必要なテストデータを準備

能力:
- データベース接続（外部連携）
- データ生成ツール実行（ツール連携）
- データ整合性チェック（自律判断）
```

#### 環境セットアップエージェント

```
ゴール: E2Eテスト実行前に環境を準備

能力:
- Docker コンテナ起動
- データベースマイグレーション実行
- ヘルスチェック確認
- エラー時の自動リトライ
```

### ガードレールの必要性

エージェントの決定は**不透明** → 監視と制限が必要:

- **タイムアウト設定**: 無限ループ防止
- **操作制限**: 本番環境へのアクセス禁止
- **承認フロー**: 重要な操作は人間の承認が必要
- **ログ記録**: すべての決定とアクションを記録

### コンテキスト埋め込み（RAG）

RAG（Retrieval-Augmented Generation）で関連ドキュメント・仕様をプロンプトに自動注入:

```
エージェントがテストケース生成時に:

1. ベクトルDBから関連する仕様ドキュメントを検索
2. 検索結果をプロンプトに自動挿入
3. コンテキストを含んだプロンプトでテストケース生成
```

**効果**: プロジェクト固有のコンテキスト不足問題を緩和。

---

## まとめ

AI活用テストテクニックの要点:

1. **TDD × AI** - 人間がテスト意図を主導、AIがコード生成を加速
2. **リスク駆動** - モデル活用 → 具体的プロンプト → 批判的評価
3. **テストデータ生成** - 構造化プロンプト、形式変換、関連データ生成
4. **UI自動化** - コンポーネント単位で活用（Page Object、アサーション等）
5. **探索的テスト** - チャーター生成、ヒューリスティック活用、レポート支援
6. **AIエージェント** - 自律的なテストサポート、ガードレール必須

すべてのテクニックで共通: **人間が目的を決め、AIが実行を加速する。**
