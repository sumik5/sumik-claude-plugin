# 品質チェックリスト

実装完了前に確認すべき項目をまとめたチェックリストです。

## 📋 目次
1. [実装完了前チェックリスト](#実装完了前チェックリスト)
2. [コードスメル検出](#コードスメル検出)
3. [リファクタリング判断](#リファクタリング判断)
4. [設計原則の確認](#設計原則の確認)

---

## 実装完了前チェックリスト

### 🎯 SOLID原則の遵守

#### Single Responsibility（単一責任）
- [ ] 各クラス・関数は単一の責任のみを持つ
- [ ] 「変更する理由」は1つだけ
- [ ] 複数の関心事が混在していない

**確認方法**:
```
クラス/関数を説明してみる
→ 「〜と〜をする」となる場合は分割を検討
→ 「〜をする」と単純に説明できればOK
```

#### Open/Closed（開放閉鎖）
- [ ] 拡張に開いている（新機能を追加しやすい）
- [ ] 修正に閉じている（既存コードを変更しない）
- [ ] インターフェース・抽象クラスで拡張可能

**確認方法**:
```
新しい機能を追加する場合
→ 既存のif文やswitch文を修正する必要がある場合は要改善
→ 新しいクラスを追加するだけなら良い設計
```

#### Liskov Substitution（リスコフの置換）
- [ ] 派生クラスは基底クラスと置換可能
- [ ] サブクラスは親クラスの契約を破らない
- [ ] 継承よりコンポジションを優先

**確認方法**:
```
親クラス型の変数に子クラスを代入
→ 期待通り動作するかテスト
→ 例外が発生する場合は継承関係を見直す
```

#### Interface Segregation（インターフェース分離）
- [ ] 使用しないメソッドへの依存を強制していない
- [ ] 小さく特化したインターフェース
- [ ] 必要な機能のみを実装

**確認方法**:
```
実装クラスで空実装やエラー投げているメソッドがある
→ インターフェースが大きすぎる
→ 分割を検討
```

#### Dependency Inversion（依存関係逆転）
- [ ] 抽象（インターフェース）に依存
- [ ] 具象クラスに直接依存していない
- [ ] 依存性注入（DI）を活用

**確認方法**:
```
new演算子でクラスを直接生成している箇所を確認
→ 多い場合はDIコンテナの導入を検討
→ テスト時にモックを注入できるか確認
```

---

### 🎨 クリーンコードの基本

#### 命名
- [ ] 意図が明確な命名
- [ ] 検索可能な名前（定数化）
- [ ] 発音可能な名前
- [ ] 一貫性のある命名規則

**NG例**:
```typescript
// ❌
let d: number  // 何の日数？
let temp: any  // 何の一時変数？
let usrNm: string  // 省略しすぎ

// ✅
let daysSinceCreation: number
let temporaryUserData: User
let userName: string
```

#### 関数
- [ ] 関数は小さい（理想は20行以内）
- [ ] 単一の責任
- [ ] 引数は0-2個（最大3個）
- [ ] 副作用を避ける

**確認方法**:
```
関数が画面に収まらない → 分割を検討
引数が3個以上 → オブジェクトで渡す
テストが書きにくい → 責任が多すぎる可能性
```

#### ネスト
- [ ] 深いネスト（3階層以上）を避ける
- [ ] 早期リターンでガード句を使用
- [ ] 複雑な条件は関数化

**NG例**:
```typescript
// ❌ 深いネスト
if (user) {
  if (user.isActive) {
    if (user.hasPermission) {
      // 処理
    }
  }
}

// ✅ 早期リターン
if (!user) return
if (!user.isActive) return
if (!user.hasPermission) return
// 処理
```

---

### 📐 設計とアーキテクチャ

#### DRY（Don't Repeat Yourself）
- [ ] コードの重複を避ける
- [ ] 共通処理は関数化・モジュール化
- [ ] Magic Numberを定数化

**確認方法**:
```
同じコードが3回以上出現 → 関数化を検討
数値リテラルが複数箇所 → 定数化を検討
```

#### YAGNI（You Aren't Gonna Need It）
- [ ] 不要な機能を実装していない
- [ ] 将来の拡張性のための過度な抽象化を避ける
- [ ] 現在必要な機能のみを実装

**確認方法**:
```
「将来使うかもしれない」機能がある
→ 現在必要か再確認
→ 不要なら削除
```

#### KISS（Keep It Simple, Stupid）
- [ ] シンプルな設計
- [ ] 過度な抽象化を避ける
- [ ] 理解しやすいコード

**確認方法**:
```
他の開発者が理解できるか
→ 説明が長くなる場合は複雑すぎる
→ シンプル化を検討
```

---

## コードスメル検出

### 🚨 レッドフラグ（即座に修正すべき）

#### 1. 巨大なクラス・関数
```typescript
// ❌ 500行以上のクラス
class UserManager {
  // 多数のメソッド...
}

// ✅ 責任を分割
class UserRepository { }
class UserService { }
class UserValidator { }
```

#### 2. 長いパラメータリスト
```typescript
// ❌ 5個以上の引数
function createUser(name, email, age, address, phone) { }

// ✅ オブジェクトで渡す
function createUser(userData: UserData) { }
```

#### 3. 重複コード
```typescript
// ❌ 同じ処理が複数箇所
function processUserA(user) {
  if (!user.email.includes('@')) throw new Error('Invalid email')
  // ...
}

function processUserB(user) {
  if (!user.email.includes('@')) throw new Error('Invalid email')
  // ...
}

// ✅ 関数化
function validateEmail(email: string) {
  if (!email.includes('@')) throw new Error('Invalid email')
}
```

#### 4. マジックナンバー
```typescript
// ❌
if (user.age > 18) { }
setTimeout(() => {}, 5000)

// ✅
const ADULT_AGE = 18
const DEFAULT_TIMEOUT_MS = 5000

if (user.age > ADULT_AGE) { }
setTimeout(() => {}, DEFAULT_TIMEOUT_MS)
```

#### 5. デッドコード
```typescript
// ❌ 使用されていない関数・変数
function oldFunction() { }  // どこからも呼ばれない
const unusedVariable = 10   // 使用されていない

// ✅ 削除（Git履歴で管理）
```

---

### ⚠️ イエローフラグ（改善を検討すべき）

#### 1. コメントアウトされたコード
```typescript
// ❌
// function oldImplementation() {
//   // 古いコード
// }

// ✅ 削除（必要ならGit履歴から復元）
```

#### 2. 過度な条件分岐
```typescript
// ❌ switch文が巨大
switch (type) {
  case 'A': // 処理A
  case 'B': // 処理B
  case 'C': // 処理C
  // ... 20個以上のcase
}

// ✅ ポリモーフィズム
interface Handler {
  handle(): void
}

const handlers: Record<string, Handler> = {
  A: new HandlerA(),
  B: new HandlerB(),
  C: new HandlerC()
}

handlers[type].handle()
```

#### 3. 深いネスト
```typescript
// ❌ 3階層以上
if (a) {
  if (b) {
    if (c) {
      // 処理
    }
  }
}

// ✅ 早期リターン
if (!a) return
if (!b) return
if (!c) return
// 処理
```

#### 4. 長いメソッドチェーン
```typescript
// ❌ 読みにくい
user.getOrders().filter(o => o.status === 'pending').map(o => o.total).reduce((a, b) => a + b, 0)

// ✅ 変数に分割
const pendingOrders = user.getOrders().filter(o => o.status === 'pending')
const orderTotals = pendingOrders.map(o => o.total)
const totalAmount = orderTotals.reduce((a, b) => a + b, 0)
```

---

## リファクタリング判断

### いつリファクタリングすべきか

#### 🔴 即座にリファクタリング
- [ ] バグの原因となっている
- [ ] セキュリティリスクがある
- [ ] パフォーマンス問題がある
- [ ] 新機能追加の障害になっている

#### 🟡 計画的にリファクタリング
- [ ] テストが書きにくい
- [ ] 変更の影響範囲が予測できない
- [ ] 同じバグが繰り返し発生
- [ ] コードレビューで指摘が多い

#### 🟢 余裕があればリファクタリング
- [ ] コードスメルがある
- [ ] 命名が不適切
- [ ] コメントが多すぎる（コードで説明できる）

### リファクタリングの手順

1. **テストを書く**
   - 既存の振る舞いを保証するテスト
   - リファクタリング後も同じ動作を確認

2. **小さく変更**
   - 一度に1つの改善
   - コミットを細かく分ける

3. **テストを実行**
   - 各ステップでテスト
   - 失敗したら戻す

4. **レビュー**
   - コードレビューで確認
   - 改善点を議論

---

## 設計原則の確認

### ✅ 良い設計のサイン

- [ ] クラス・関数が小さい
- [ ] 責任が明確
- [ ] テストが書きやすい
- [ ] 変更が局所的（影響範囲が限定）
- [ ] 新機能を追加しやすい
- [ ] コードレビューで理解しやすいと言われる

### ❌ 悪い設計のサイン

- [ ] クラス・関数が大きい（100行以上）
- [ ] 責任が不明確（説明が長い）
- [ ] テストが書きにくい（モックが多数必要）
- [ ] 変更が広範囲に影響
- [ ] 新機能追加のたびに既存コードを大幅修正
- [ ] コードレビューで質問が多い

---

## 🎯 実装完了前の最終チェック

実装完了時に以下をすべて確認してください：

### 設計・アーキテクチャ
- [ ] SOLID原則を遵守しているか
- [ ] DRY原則に従っているか
- [ ] YAGNIに従っているか（不要な機能を実装していないか）
- [ ] 適切な抽象化レベルか

### コードの品質
- [ ] 関数は小さく単一責任か（20行以内が理想）
- [ ] 引数は最小限か（0-2個が理想、最大3個）
- [ ] 深いネスト（3階層以上）を避けているか
- [ ] マジックナンバーを定数化しているか

### 命名と可読性
- [ ] 命名は一貫性があり意図が明確か
- [ ] コメントは必要最小限か（コードで説明できることをコメントにしていないか）
- [ ] 早期リターンを活用しているか

### エラーハンドリング
- [ ] 適切なエラーハンドリングがあるか
- [ ] エラーメッセージは明確か
- [ ] 例外は適切にキャッチしているか

### テスト
- [ ] ユニットテストが書かれているか
- [ ] テストは意味のあるテストか（形式的なテストでないか）
- [ ] エッジケースをカバーしているか

### セキュリティ
- [ ] 入力検証をしているか
- [ ] SQLインジェクション対策をしているか
- [ ] XSS対策をしているか
- [ ] 認証・認可が適切か

### パフォーマンス
- [ ] 不要なループや計算がないか
- [ ] データベースクエリは最適化されているか
- [ ] キャッシュを適切に使用しているか

### ドキュメント
- [ ] 公開APIにJSDocがあるか
- [ ] 複雑なロジックに説明コメントがあるか
- [ ] READMEは更新されているか

---

## 🔗 関連ドキュメント

- [SOLID原則の詳細](./SOLID-PRINCIPLES.md)
- [クリーンコードの基礎](./CLEAN-CODE-BASICS.md)
- [クイックリファレンス](./QUICK-REFERENCE.md)

## 📖 参考リンク

- [品質チェックリスト メインページ](./SKILL.md)
