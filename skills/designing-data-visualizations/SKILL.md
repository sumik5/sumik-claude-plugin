---
description: >-
  Comprehensive data visualization principles covering chart type selection, color scales,
  design best practices, and data storytelling. Use when creating charts, dashboards,
  or any visual data representation. For UI/UX design principles, use applying-design-guidelines instead.
  For technical diagrams (flowcharts, architecture), use mermaid-diagrams instead.
---

# データビジュアライゼーション原則

データをグラフィカルな表現に変換するための包括的なガイド。チャート選択・カラースケール・デザイン原則・データストーリーテリングを網羅する。

## スコープ

| 対象 | 対象外 |
|------|--------|
| 統計チャート・グラフ・ダッシュボード | UIコンポーネント設計（→ `applying-design-guidelines`） |
| カラースケール設計 | フローチャート・アーキテクチャ図（→ `mermaid-diagrams`） |
| データストーリーテリング | インフォグラフィック全般 |
| 不確かさの可視化 | 動的なデータバインディング実装 |

---

## エスセティクスマッピング（データ → 視覚要素）

データの値を視覚要素（エスセティクス）にマッピングすることがビジュアライゼーションの本質。

### データ型と推奨視覚要素

| データ型 | 例 | 推奨エスセティクス | 不適切 |
|---------|-----|------------------|--------|
| **連続量** | 気温、売上高、身長 | 位置（x/y軸）、色の濃淡、サイズ | 形、線種 |
| **離散量（順序あり）** | 1等・2等・3等、評価★ | 位置、色の濃淡 | 位相のない色相 |
| **カテゴリ（名義）** | 性別、国名、製品種別 | 形、色相（質的スケール）、位置 | 連続的な色 |
| **日時** | 日付、月、年 | x軸（時間軸）、極座標（周期性） | サイズ単独 |
| **テキスト** | 遺伝子名、ラベル | 直接ラベル、ツールチップ | − |

### 視覚要素の特性

```
位置    │ ✅ 連続・離散両対応 │ 最も精度の高い知覚
形      │ ❌ 離散データのみ  │ カテゴリ区別に有効（最大5〜6種）
色相    │ ❌ 離散データのみ  │ CVD（色覚異常）に配慮必須
色の濃淡 │ ✅ 連続・離散両対応 │ 順序・量の表現に適する
サイズ  │ ✅ 連続・離散両対応 │ 面積として知覚されるため過小評価されやすい
線種    │ ❌ 離散データのみ  │ 黒白印刷での代替表現として有効
```

### スケールによるマッピング

- 1つの変数 → 1つのエスセティクス（原則）
- 同じ変数を複数エスセティクスで表現（**冗長化**）することで視認性が向上
- 異なる変数を同一エスセティクスに割り当てると混乱が生じる

---

## 座標系選択ガイド

### 直交座標系（デカルト座標系）

最も一般的。x/y軸ともに**同一スケール**を保つことが基本。

**縦横比（aspect ratio）の原則:**
- データの変化の「向き」が45°付近になるよう調整（banking to 45°）
- x/yの範囲を恣意的に変えるとデータの印象が歪む

### 数値軸のスケール選択

| 状況 | 推奨スケール | 理由 |
|------|------------|------|
| 絶対量・差分を見る | **線形スケール** | 直感的な面積・長さの比較 |
| 比率・倍率を比較する | **対数スケール** | 乗法的な変化を等間隔に表現 |
| 0を含む比率データ（count等） | **平方根スケール** | 0が意味を持ちつつ外れ値を抑制 |
| 中心値からの偏差を見る | **線形（0中心）** | 正負の対称性を保持 |

> **対数スケールの注意点:** 軸ラベルは変数名のみ（例：「売上高」）。「log(売上高)」は誤り。

### 極座標系

| 適切なケース | 理由 |
|------------|------|
| 周期性のあるデータ（時刻・月・曜日） | 循環の構造をそのまま表現できる |
| 風配図・レーダーチャート | 方向性データに直感的 |

> ⚠️ 扇形の**面積**は角度に比例するが、人間は角度よりも長さを正確に知覚できる。円グラフの多用に注意。

### 地図投影法

| 投影法 | 特徴 | 用途 |
|--------|------|------|
| 正距方位図法（直交経緯度） | シンプルだが面積・角度が歪む | 大まかな位置確認 |
| グード図法 | 面積正確、陸塊が分断される | 面積比較が主目的の場合 |
| ロビンソン/ヴィンケル図法 | 面積・角度のバランス型 | 世界全図の標準的な選択肢 |

---

## チャート選択クイックリファレンス

### 量（Amounts）

| データ構造 | 推奨チャート | 避けるべきチャート |
|-----------|------------|-----------------|
| 単一カテゴリの量 | **棒グラフ**（y軸は0始点） | 3D棒グラフ（奥行きで歪む） |
| 少数カテゴリの量 | **ドットプロット** | 円グラフ（3つ以上で不正確） |
| 2変数×カテゴリ | **グループ棒グラフ/ヒートマップ** | 積み上げ+別変数の混在 |
| 多カテゴリ×量 | **ヒートマップ** | 棒グラフ（カテゴリ多すぎ） |

### 分布（Distributions）

| 目的 | 推奨チャート | 補足 |
|------|------------|------|
| 単一分布の形状 | **ヒストグラム / KDE密度プロット** | bin幅の選択が重要 |
| 複数グループの分布比較 | **箱ひげ図 / バイオリンプロット** | バイオリンは分布形状も見える |
| 外れ値の可視化 | **箱ひげ図 + ストリッププロット** | 生データを重ねると情報量増 |
| 累積分布 | **ECDF / Q-Qプロット** | 理論分布との比較に有効 |

### 内訳（Proportions）

| 目的 | 推奨チャート | 注意 |
|------|------------|------|
| 全体の内訳（少数カテゴリ） | **円グラフ / ドーナツグラフ** | 4カテゴリ以内を推奨 |
| 複数グループ間の内訳比較 | **積み上げ棒グラフ** | 中間カテゴリは読み取りにくい |
| 階層的な内訳 | **ツリーマップ / サンキー図** | ツリーマップは面積比較 |
| カテゴリ×カテゴリの内訳 | **モザイク図** | 両軸が比例する |

### 関連性（Relationships）

| 目的 | 推奨チャート | 注意 |
|------|------------|------|
| 2変数の相関 | **散布図** | オーバープロット対策が必要 |
| 多変数の相関一覧 | **コレログラム（ペアプロット）** | 変数数が多いと視認性低下 |
| 次元削減の結果 | **PCA散布図** | 軸の解釈を必ず記載 |
| 対応のあるデータ | **スロープチャート / 連結散布図** | 変化の方向性が明確 |

### 時系列（Time Series）

| 目的 | 推奨チャート | 避けるべきチャート |
|------|------------|-----------------|
| 連続的な変化 | **折れ線グラフ** | 棒グラフ（時刻が連続の場合） |
| 累積量・全体量の変化 | **面グラフ** | 基準線なしの積み上げ面 |
| 複数系列のトレンド | **折れ線 + 直接ラベル** | 凡例のみ（照合が煩雑） |

### 地理空間（Geospatial）

| 目的 | 推奨チャート | 注意 |
|------|------------|------|
| 地域ごとの量・割合 | **コロプレス図**（連続的/発散的スケール） | 面積大の地域が目立ちすぎる問題 |
| 人口等で面積調整 | **カルトグラム** | 地理的認識が変形する |
| 地点の位置情報 | **バブルマップ / 散布図マップ** | シンボルの重なりに注意 |

### 不確かさ（Uncertainty）

| 目的 | 推奨チャート |
|------|------------|
| 推定値の信頼区間 | **エラーバー / 信頼帯** |
| 回帰曲線の不確かさ | **信頼帯（geom_ribbon相当）** |
| 仮説検定の直感的表示 | **仮説結果プロット（HOPs）** |
| ベイズ事後分布 | **密度プロット / ハーフアイプロット** |

---

## カラースケール基本ガイド

### 3種類のスケールと使い分け

```
質的（Qualitative）スケール
  用途: カテゴリ変数（順序なし）を区別
  特徴: 色相を変える、明度は揃える
  例:   国名、製品種別、性別
  NG:   「多い/少ない」のような順序を表現するのに使用

連続的（Sequential）スケール
  用途: 量や密度などの連続値を表現
  特徴: 低値=薄い色、高値=濃い色（単調増加）
  例:   人口密度、売上金額、温度（最小値が自然な0の場合）
  NG:   「増加/減少」のような正負の比較

発散的（Diverging）スケール
  用途: 自然な中心点（0や平均など）からの偏差
  特徴: 中心=ニュートラル色（白・灰）、両端=対照的な色
  例:   増減率、偏差、賛否の割合（50%基準）
  NG:   データに自然な中心点がない場合
```

### カラースケール設計の原則

| 原則 | 詳細 |
|------|------|
| **単調性** | 連続スケールは明度が単調に増減すること。レインボーカラーは非単調で誤解を招く |
| **CVD対応** | 色覚異常（Color Vision Deficiency）の人が識別できるスケールを選ぶ。岡部・伊藤スケールはCVD安全 |
| **グレースケール変換** | 白黒印刷・コピーでも判読できるか確認 |
| **要素サイズ考慮** | 小さな点・細い線は色の識別が難しい。サイズに応じてコントラストを調整 |
| **色数制限** | 質的スケールは最大8色程度。それ以上は識別が困難 |

---

## デザイン原則 Top 10 チェックリスト

### 図を作成したら必ず確認すること

- [ ] **プロポーショナルインクの原則** — 視覚要素の面積・長さはデータ値に比例しているか。棒グラフのy軸は0始点か
- [ ] **軸の0起点** — 棒グラフ・面グラフはy軸が0から始まっているか（折れ線グラフは例外も許容）
- [ ] **3D効果の排除** — 3D棒グラフ・3D円グラフを使っていないか。奥行きはデータを歪める
- [ ] **適切な色数** — 質的スケールで5〜8色以内か。不必要な色分けをしていないか
- [ ] **CVD対応色** — レインボーカラーを避け、CVD安全なパレット（岡部・伊藤スケール等）を使用しているか
- [ ] **表現の冗長化** — 重要なカテゴリは色+形など複数エスセティクスで識別できるか
- [ ] **直接ラベル** — 凡例の代わりにデータに直接ラベルを付けられないか（照合コストを削減）
- [ ] **グリッドライン最適化** — グリッドは薄く控えめか。データよりグリッドが目立っていないか
- [ ] **文字サイズ** — すべてのテキスト（軸ラベル・タイトル・凡例）が読める最小サイズを確保しているか
- [ ] **スモールマルチプル** — 複数パネルの場合、軸のスケールは統一されているか

---

## ugly / bad / wrong 分類フレームワーク

問題のある図を3種類に分類することで、修正の方向性が明確になる。

| 分類 | 定義 | 例 | 修正方針 |
|------|------|-----|---------|
| **ugly（見栄えが悪い）** | 技術的・情報的には正確だが、美的・スタイル的に問題がある | 過剰なグリッド、不統一フォント、彩度過多な色 | デザインの磨き込み |
| **bad（不適切）** | 主観的・客観的に問題があり、データを誤解させる可能性がある | 複数のy軸スケール混在、3D棒グラフ、過多な色数 | チャートタイプ・設定の再考 |
| **wrong（誤り）** | 客観的に事実と異なるデータを表示している | y軸が0からスタートしていない棒グラフでの誤差強調、スケール未明示 | データ表現の根本的な修正 |

### 診断フロー

```
図に問題がある？
  ↓
データ値と視覚が対応していない → wrong（誤り）
データは正しいが誤解を招く    → bad（不適切）
技術的に正しいが見にくい      → ugly（見栄えが悪い）
```

---

## リファレンスファイル

| ファイル | 内容 |
|---------|------|
| [CHART-TYPES.md](references/CHART-TYPES.md) | 量・分布・内訳・関連性・時系列・地理空間・不確かさ別チャートタイプ詳細 |
| [DESIGN-PRINCIPLES.md](references/DESIGN-PRINCIPLES.md) | デザイン原則の詳細解説・アンチパターン・修正例 |
| [COLOR-USAGE.md](references/COLOR-USAGE.md) | カラースケール詳細・CVD対応パレット・色の使いすぎ回避 |
| [STORYTELLING.md](references/STORYTELLING.md) | データストーリーテリング・注釈の付け方・画像形式・推奨ソフトウェア |
