# チャートタイプ詳細リファレンス

データの性質と目的に応じた最適なチャートタイプ選択ガイド。

---

## 1. 量の可視化

### いつ使うか
個別カテゴリの量（カウント・合計・平均など）を比較したいとき。

### 手法選択テーブル

| データの特徴 | 推奨手法 | 注意点 |
|---|---|---|
| カテゴリ数 ≤ 10、ゼロ基線が意味を持つ | 棒グラフ（縦）| ゼロ基線必須 |
| カテゴリ名が長い、カテゴリ数が多い | 棒グラフ（横）| 自然な順序で並べる |
| 値の差が重要で棒が長すぎる | ドットプロット | 意味のある順序で並べる |
| 2つのカテゴリ変数を同時に表現 | グループ化棒グラフ | グループ数は最大4程度 |
| 全体に対する部分の構成を示したい | 積み上げ棒グラフ | 基準線のないカテゴリは比較困難 |
| 時系列×カテゴリ、大規模マトリクス | ヒートマップ | カラースケール設計が重要 |

### 詳細

**棒グラフ**の並び順は意味を持たせること。アルファベット順や恣意的な順序は避け、値の大小順・時間順・自然な順序を用いる。ラベルが斜め表示になる場合は横棒グラフへの切り替えを検討する。

**グループ化棒グラフ**では、どちらの変数をグループ化するかで読み取れる比較が変わる。主要な比較軸を横軸に配置し、グループを色で区別する。グループ数が多すぎる場合はファセット（小倍数）を活用する。

**ドットプロット**は棒グラフよりも広い値の範囲に適している。全体の差（最高値と最低値）よりも個別の値そのものに注目させたい場合に有効。

**ヒートマップ**は国別・年別など2つのカテゴリ軸を持つデータに適している。カラースケールの設計（単調増加スケール、ビニング等）が読み取りやすさに大きく影響する。

### アンチパターン
- 棒グラフのゼロ基線を省略する（差を誇張してしまう）
- 意味なくアルファベット順で並べる
- ヒートマップで発散型カラースケールをゼロ基準なしに使う

---

## 2. 分布の可視化

### いつ使うか
データがどのような範囲・形状に分布しているかを示したいとき。

### 手法選択テーブル

| データの特徴 | 推奨手法 | 注意点 |
|---|---|---|
| 単一変数の分布形状を概観したい | ヒストグラム | ビン幅の選択が解釈を左右する |
| 滑らかな分布推定が必要 | 密度プロット（KDE）| データが存在しない領域への漏れに注意 |
| 分布を正確に表現・比較したい | ECDF | パラメータ選択が不要 |
| 正規分布からのずれを確認したい | Q-Qプロット | 裾の重さや歪みを検出 |
| 中央値・四分位数・外れ値を示したい | 箱ひげ図 | 分布の形状が見えない |
| 分布形状と統計量を両立したい | バイオリンプロット | サンプルサイズが小さい場合は過大評価に注意 |
| 多数グループの分布を時系列で比較 | リッジラインプロット | ヒストグラム版は視覚的に混雑しやすい |
| 少数の個別データ点を見たい | ストリップチャート/Sina plot | 点が重なる場合はジッタリング |

### 詳細

**ヒストグラム**のビン幅は小さすぎると過学習したノイズが見え、大きすぎると重要なパターンが消える。3〜5通りのビン幅で試すことを推奨。

**密度プロット（KDE）**のバンド幅は大きいほど滑らか、小さいほど細部を拾う。注意すべきアンチパターンは、年齢や価格など非負の変数でカーネルが負の領域まで広がること。この場合はヒストグラムを用いるか、境界付き密度推定を使う。

**ECDF**は「全データの何%がこの値以下か」を直接読み取れる。ヒストグラムや密度プロットのようなビン幅やバンド幅の選択が不要で、データの特性を正確に表現する。

**箱ひげ図**のひげはデフォルトでIQRの1.5倍。外れ値は個別の点として表示する。分布が多峰性の場合には見逃してしまうため、バイオリンプロットや個別データ点の表示と組み合わせることが多い。

**リッジラインプロット**は密度プロットを縦に重ね、横軸を共有することでグループ間の比較をしやすくする。時系列の分布の変化などに特に有効。

### アンチパターン
- 積み上げヒストグラムを複数グループの比較に使う（読みにくく重ね合わせヒストグラムと混同される）
- 分布を完全に隠すエラーバーのみで分布を表現する
- 密度推定が負の値に広がるのを許容する

---

## 3. 内訳の可視化

### いつ使うか
全体の中で各部分が占める割合や構成比を示したいとき。

### 手法選択テーブル

| データの特徴 | 推奨手法 | 注意点 |
|---|---|---|
| カテゴリ数 2〜3個、全体像を強調 | 円グラフ | カテゴリが多いと比較困難 |
| 各カテゴリの絶対的な比較が重要 | 横並び棒グラフ | 合計値が見えにくい |
| 全体と部分の両方を示したい | 積み上げ棒グラフ（縦/横）| 基準線のないカテゴリは比較困難 |
| 連続変数×カテゴリの構成比 | 積み上げ密度グラフ | 全体のN数も一緒に示す |
| 2つのカテゴリ変数の内訳関係 | モザイク図 | 面積エンコーディングが慣れ不要 |
| 階層的な内訳の面積比較 | ツリーマップ | 面積の比較は不正確になりやすい |
| 複数カテゴリ変数のフロー可視化 | パラレルセットプロット | カテゴリ変数の順序が読みやすさに影響 |

### 詳細

**円グラフ**は「合計が100%」という文脈が明確な場合、少数カテゴリで有効。ドーナツチャートは中央のスペースを活用できる利点がある。カテゴリが4つ以上になると、横並び棒グラフへの切り替えを検討する。

**積み上げ棒グラフ**では最下部のカテゴリのみが正確に比較できる。中間のカテゴリは基準線が変動するため比較困難。時系列での構成比変化を示すのに適している。

**モザイク図**は矩形の幅が一方の変数、高さが他方の変数に比例する。2変数間の関係と各セルのカウントを同時に表現できる。

**ツリーマップ**は面積が量に比例する矩形を並べる。円グラフより面積比較が正確で、階層構造を持つデータに特に適している。

**パラレルセットプロット**は帯の幅がデータ量に比例し、異なるカテゴリ間のフローを可視化する。強調したいカテゴリを左端に配置し、左から右に自然に読めるよう変数を並べ直すことが重要。

### アンチパターン
- 合計が100%にならないデータに円グラフを使う
- 積み上げ棒グラフで中間カテゴリの比較を主な目的にする
- パラレルセットプロットでカテゴリ順序を最適化せずに使う

---

## 4. 関連性の可視化

### いつ使うか
2つ以上の量的変数間の関係・相関を示したいとき。

### 手法選択テーブル

| データの特徴 | 推奨手法 | 注意点 |
|---|---|---|
| 2変数の相関 | 散布図 | 点の重なりに注意 |
| 3変数（3つ目はサイズ）の相関 | バブルチャート | バブルサイズの認識は不正確 |
| 3変数（3つ目はカテゴリ）の相関 | 色分け散布図 | カテゴリ数は最大5〜6 |
| 多変数の相関行列 | コレログラム | 対角成分に個別分布を入れると情報量増 |
| 高次元データの構造探索 | PCA散布図 | 主成分の解釈に注意 |
| 対応のある2時点データ | スロープグラフ | 交差が多い場合は他の手法を検討 |
| 対応のある3時点以上のデータ | 折れ線グラフ（面識付き） | データ数が多い場合は選択的に表示 |

### 詳細

**散布図**は2変数の関係を最も直接的に表現する。第3変数は色（カテゴリ）またはサイズ（量）でエンコードできるが、3変数以上の同時可視化には散布図行列が有効。ただし人間のサイズ認識は位置認識より不正確なため、重要な変数には位置エンコーディングを使う。

**コレログラム**は多変数データセットの相関係数行列をタイル状に表示する。色で相関係数を表現し、円サイズを重ねることで相関の強さを視覚的に強調できる。

**PCA（主成分分析）**は高次元データを2〜3次元に圧縮して散布図で可視化する。各主成分が元変数のどの組み合わせに対応するか（ローディング）を別途確認することが重要。

**スロープグラフ**は2時点での値の変化を線の傾きで表現する対応データ向けの手法。時系列全体よりも「変化の大きさと方向」を強調したい場合に有効。

### アンチパターン
- バブルチャートのバブルサイズを精密な比較に使う
- コレログラムの対角線上の不要な自己相関セルを残す
- PCA結果を元変数の解釈なしに提示する

---

## 5. 時系列の可視化

### いつ使うか
時間の経過に伴う変数の変化を示したいとき。

### 手法選択テーブル

| データの特徴 | 推奨手法 | 注意点 |
|---|---|---|
| 1つの変数の経時変化 | 折れ線グラフ（点+線）| データが密な場合は点を省略 |
| 全体的なトレンドを強調したい | 面積グラフ（折れ線+塗りつぶし）| ゼロ基線が必要 |
| 複数変数の経時変化（〜5変数）| 色分け折れ線グラフ | 凡例より直接ラベルを推奨 |
| 2変数の同時変化パターン | 連結散布図（位相平面図）| 方向・速度情報（色・ラベル）が必須 |
| ノイズが多くトレンドを見たい | 移動平均・LOESS平滑化 | 複数の窓幅を比較する |
| 長期トレンドから短期変動を分離 | デトレンド・時系列分解 | トレンドの仮定（線形・指数など）を明示 |
| 多変数の用量反応関係 | 用量反応曲線 | 誤差帯を含める |

### 詳細

**折れ線グラフ**の線は「データを表すものではなく視線の補助」であることを意識する。点が密集している場合は点を省略して折れ線のみにすることで全体的なトレンドが際立つ。

**移動平均**の窓幅は意図的に選択する。短い窓（20日）は短期トレンドを、長い窓（100日）は長期トレンドを表す。移動平均を窓の終点でなく中央にプロットすることで位相のずれを防ぐ。

**LOESS（局所加重回帰平滑化）**は移動平均より滑らかで、データ範囲全体をカバーする。スプライン・GAMなど複数の平滑化手法はデータ端部での挙動が大きく異なるため、手法の選択に注意する。

**時系列分解（STL等）**は「長期トレンド + 季節変動 + 残差」に分解する。残差は長期トレンドと季節変動で説明できない変動を表し、異常検知にも活用できる。

**デトレンド**はデータを長期トレンドの予測値で割ることで、トレンドに隠れた相対的な変動を明示する。特に指数的成長を示すデータに有効。

### アンチパターン
- 連結散布図で時間方向の情報（色・ラベル）なしに使う
- 移動平均を窓の終点にプロットして位相ずれを引き起こす
- y軸をゼロから始めない面積グラフを使う

---

## 6. 地理空間データの可視化

### いつ使うか
地理的な分布、密度、値の空間パターンを示したいとき。

### 手法選択テーブル

| データの特徴 | 推奨手法 | 注意点 |
|---|---|---|
| 地域ごとの値の分布 | コロプレス図 | 面積の大きな地域が視覚的に過大評価 |
| 人口等の変数に比例した表現 | カルトグラム | 地形の変形で位置の認識が困難 |
| 均一な視覚的重み付けが必要 | カルトグラムヒートマップ（正方形）| 正確な地理的位置は犠牲 |
| 個別地点データの表示 | 散布地図（点プロット）| 点の重なりに注意 |
| 複数属性を地図上で比較 | レイヤー構成 | レイヤーの順序が重要 |

### 詳細

**投影法の選択**：
- 正角図法（メルカトル等）：局所的な角度・形状を保存するが、極地付近の面積が歪む。航法・ウェブ地図に適合
- 正積図法（アルベルス等）：面積を正確に保存するが、形状が歪む。面積比較を含む地図に推奨

用途に応じて適切な投影法を選ぶこと。特に大陸・国レベルの地図では正積図法を推奨。

**レイヤー構成**の基本順序：地形（ベースマップ）→ 道路・境界線 → データレイヤー（点・線・面）→ ラベル・スケール・方位。

**コロプレス図**では：
- 連続的カラースケールよりもビニング（5〜7クラス）が読みやすい
- 単調増加スケールが基本（人口密度：薄→濃）
- 人口密度が低い広大な地域（アラスカ等）が視覚的に支配する問題を認識する

**カルトグラム**は「実際の面積」でなく「人口数」など別の変数に比例して地域サイズを変形する。地理的な位置関係が失われるトレードオフを理解した上で使う。

### アンチパターン
- 人口データをコロプレス図で表示（面積の大きな低人口地域が誤解を招く）
- 縮尺なしで地図を表示する
- メルカトル図法で面積比較を行う

---

## 7. 不確かさの可視化

### いつ使うか
推定値・予測値の信頼性や確率的不確かさを明示したいとき。

### 手法選択テーブル

| データの特徴 | 推奨手法 | 注意点 |
|---|---|---|
| 低確率の直感的理解 | 度数フレーミング（ウェーファーチャート）| 100個のマスが一般的 |
| 確率分布そのものを示したい | 確率密度グラフ | 面積で確率を表現 |
| 離散的な結果の分布 | 分位点ドットプロット | ドット数は10〜50程度が適切 |
| 点推定の不確かさ | エラーバー（標準誤差・信頼区間）| 何を表しているか必ずラベル明示 |
| 複数信頼水準を同時表示 | 階級付きエラーバー | 最大2〜3水準を推奨 |
| 曲線フィッティングの不確かさ | 信頼帯 | 階級付き信頼帯でさらに明確に |
| 不確かさの直感的理解を促進 | 仮説結果プロット（HOP）| アニメーション形式が最も効果的 |

### 詳細

**度数フレーミング**は確率を「100件中N件」として表現する。1%、10%、40%など小さな確率の違いを直感的に伝えるのに特に有効。マスをランダムに配置することで1回の試行の不確かさも表現できる。

**エラーバー**で最も重要なのは「何を表しているか」の明示：
- 標準偏差：母集団の散らばり
- 標準誤差：平均値の推定精度
- 信頼区間：指定した信頼水準での推定範囲

エラーバーの誤解（決定論的解釈の誤り：信頼区間の端がクリフエッジであるかのような誤解）を防ぐため、階級付きエラーバーや信頼度ストリップを活用する。

**仮説結果プロット（HOP）**はフィッティングパラメータの事後分布から複数の「起こりうる結果」をアニメーションで逐次表示する。静的な信頼帯より不確かさの直感的理解を促進する研究結果がある。

**信頼帯**の代替として、事後分布から複数のフィッティング曲線をランダムサンプリングして重ね描きする方法も有効。単一の信頼帯より「起こりうる結果のバリエーション」として解釈しやすい。

### アンチパターン
- エラーバーが何を表しているか（標準偏差・標準誤差・信頼区間）を明示しない
- 信頼区間の境界をクリフエッジとして表示・解釈する
- 母集団のばらつきと平均値の不確かさを混同した文脈でエラーバーを使う
- HOPでアニメーション間隔が短すぎて認知処理が追いつかない

---

## チャートタイプ総合選択フロー

```
データの目的は？
├── 量を比較したい → 棒グラフ / ドットプロット / ヒートマップ
├── 分布を見たい
│   ├── 1グループ → ヒストグラム / 密度プロット / ECDF
│   └── 複数グループ → 箱ひげ図 / バイオリンプロット / リッジライン
├── 内訳を示したい
│   ├── カテゴリ少（2-3）→ 円グラフ
│   └── カテゴリ多 → 横並び棒グラフ / 積み上げ棒グラフ
├── 関連性を見たい
│   ├── 2変数 → 散布図
│   └── 多変数 → コレログラム / PCA散布図
├── 時系列を見たい
│   ├── 1-5変数 → 折れ線グラフ
│   └── トレンド抽出 → LOESS / 移動平均 / 時系列分解
├── 地理データを見たい
│   ├── 地域値の分布 → コロプレス図
│   └── 人口等で補正したい → カルトグラム
└── 不確かさを示したい
    ├── 点推定 → エラーバー / 階級付きエラーバー
    ├── 曲線 → 信頼帯
    └── 直感的理解 → HOP / 度数フレーミング
```
