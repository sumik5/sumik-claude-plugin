# データビジュアライゼーション カラー使用ガイド

データビジュアライゼーションにおける色の選択と使用のリファレンス。

---

## 1. カラースケールの3分類

### 質的カラースケール（qualitative color scales）

カテゴリデータ（名義データ）の区別に使用する。各色は等しい重みを持ち、順序や大小を示さない。

**特徴:**
- データに自然な順序がない場合に適用
- 色間に暗示的な順序が生じないよう設計
- 推奨上限: 7〜8色以内（それ以上は識別困難）

**代表的なパレット:**
| パレット | 特徴 |
|---------|------|
| 岡部・伊藤スケール（Okabe-Ito） | 色覚異常対応・本ガイドの推奨デフォルト |
| ColorBrewer Dark2 | 印刷・スクリーン両対応 |
| ggplot2 color hue scale | R/ggplot2 のデフォルト（色覚異常非対応） |

---

### 連続的カラースケール（sequential color scales）

量的データ（小→大）の視覚化に使用する。明度または彩度の連続的なグラデーションで値を表現する。

**特徴:**
- 値の増加に対応して色が単調に変化する（単調性が必須）
- 単色相スケールまたは複数色相スケールを使用
- コロプレス図や密度マップに適用

**代表的なスケール:**
| スケール | 説明 |
|---------|------|
| Viridis | 暗い青→緑→明るい黄色。知覚的に均一で色覚異常にも安全 |
| ColorBrewer Blues | 暗い青→明るい青。単色の直感的なスケール |
| Heat | 暗い赤→明るい黄色。温度的な直感に合致 |

---

### 発散的カラースケール（diverging color scales）

中央の参照値（ゼロ点や平均値など）からの正負の乖離を表現する。中央を淡色として2方向に発散する。

**特徴:**
- 中央値が明確な意味を持つ場合に使用（例: ゼロ、平均値、50%）
- 2つの連続的スケールを共通の中間色でつなぎ合わせた構造
- 中央点は白または淡いニュートラルカラー推奨

**代表的なスケール:**
| スケール | 説明 |
|---------|------|
| Blue-Red | 青（負/低）→白（中央）→赤（正/高） |
| ColorBrewer PiYG | ピンク→白→黄緑。色覚異常にも安全 |
| Brown-Teal（茶→緑がかった青） | 土地利用や環境データに多用 |

---

### アクセントカラースケール（accent color scales）

大多数のカテゴリを「背景」として低彩度に抑え、特定の1〜3カテゴリだけを高彩度色で際立たせる。

**作成方法:**
| 方法 | 説明 |
|-----|------|
| 既存パレットの彩度調整 | Okabe-Ito等の一部を薄くし、強調色だけを濃くする |
| グレー＋アクセント | グレーセット＋1〜3色の高彩度色 |
| ColorBrewerアクセント | ColorBrewerプロジェクトが提供するアクセントセット |

**使用上の注意:**
- 強調色は最大3色以内に絞る
- 「どのカテゴリを強調したいか」を先に決めてから設計する

---

## 2. カラースケール選択ガイド

| データの性質 | 推奨スケール | 具体例 |
|------------|------------|--------|
| カテゴリ（名義）データ | 質的スケール | 地域区分、種族、製品カテゴリ |
| 単方向の量的データ | 連続的スケール | 人口密度、収入、温度 |
| 中央値からの乖離 | 発散的スケール | 気温偏差、選挙結果（賛否）、変化率 |
| 大多数と少数を対比 | アクセントスケール | 特定カテゴリのハイライト |

---

## 3. 色の3つの役割

### 区別するためのツール
カテゴリ間を識別する。質的カラースケールを用い、7色以内に抑える。
異なるカテゴリには異なる色相を割り当て、明度・彩度の差を付ける。

### データの値を表現するためのツール
数値をエンコードする。連続的または発散的カラースケールを用いる。
色が値の大小を直感的に伝えられるよう、単調な明度変化を持つスケールを選ぶ。

### 目立たせるためのツール（アクセント）
特定のデータ点や系列を強調する。
アクセントカラースケール（ベースを薄くし、強調色だけを濃くする）を活用する。

---

## 4. 色覚異常への配慮

### 色覚異常の種類と発生率

| 種類 | 別名 | 発生率（男性） |
|-----|------|--------------|
| 2型3色覚（deuteranomaly/deuteranopia） | 赤緑色覚異常（緑型） | 約6% |
| 1型3色覚（protanomaly/protanopia） | 赤緑色覚異常（赤型） | 約2% |
| 3型3色覚（tritanomaly/tritanopia） | 青黄色覚異常 | 約0.02% |

**男性全体の約8%が何らかの色覚異常を持つ。** ビジュアライゼーションはこれを前提に設計する。

### 危険な色の組み合わせ
- ❌ **赤と緑のみで区別**: 2型・1型色覚者に見分けがつかない
- ❌ **青と緑のみで区別**: 3型色覚者に見分けがつかない
- ✅ **ピンクと黄緑（PiYG）**: 見かけは赤緑対比に見えるが、全種の色覚異常に対応
  - ピンク = 赤 + **青**の混色 → 2型/1型色覚者は青成分で区別できる
  - 黄緑 = 緑 + **黄色**の混色 → 3型色覚者は赤成分の違いで区別できる

### 岡部・伊藤スケール（推奨パレット）

全種の色覚異常に対して安全な8色のパレット。

| 色名 | 16進コード |
|-----|-----------|
| オレンジ | `#E69F00` |
| スカイブルー | `#56B4E9` |
| 緑 | `#009E73` |
| 黄色 | `#F0E442` |
| 青 | `#0072B2` |
| 赤みがかったオレンジ | `#D55E00` |
| 紫がかったピンク | `#CC79A7` |
| 黒 | `#000000` |

### テスト方法
1. Coblis / Color Oracle 等のCVDシミュレーターでスクリーンショットを確認
2. グレースケール変換で明度の単調性を確認
3. 小さい要素（細い線・小さな点）で特に見分けにくくなるため注意

---

## 5. 色を使う際の落とし穴

### 落とし穴1: 情報過多（色の乱用）

**問題:** 50州に50色を使うなど、色を使いすぎると凡例との照合が不可能になる。

**対策:**
- カテゴリは最大7〜8色に絞る
- 主要カテゴリを色分けし、残りは「その他」として統合
- ラベルの直接表記（direct labeling）で凡例を補完

### 落とし穴2: 非単調スケール（レインボー問題）

**問題:** レインボーカラーマップ（jet, rainbow）は知覚的に均一ではなく、単調性がない。
- グレースケール変換すると、暗→明→暗という不規則な変化が現れる
- 特定の値域（黄〜緑〜水色付近）が広い明るい帯として目立ち、恣意的な特徴が浮かび上がる
- データの任意の特徴を強調してしまい、誤読を誘発する

**対策:**
- ❌ `jet`, `rainbow` など非単調スケールの使用を禁止
- ✅ Viridis, Plasma, Magma, Cividis など知覚的に均一なスケールを使用

### 落とし穴3: 色覚異常非対応

**問題:** 赤と緑だけで重要な区別をすると、男性の約8%に伝わらない。

**対策:**
- 色だけでなく、形・パターン・ラベルでも冗長にエンコード
- 岡部・伊藤スケールを質的パレットのデフォルトとして採用
- CVDシミュレーションを必ず実施

### 落とし穴4: 小さな視覚要素での色識別

**問題:** 細い線や小さな点では、色の違いが大きな領域より識別しにくい。

**対策:**
- 細い線・小さな点にはより大きなコントラストを持つ色を選択
- サイズが小さい要素ほどCVDシミュレーション結果が悪化することを考慮

---

## 6. ベストプラクティスチェックリスト

**スケール選択**
- [ ] データの型に合ったスケールを選んでいる（質的/連続的/発散的）
- [ ] カテゴリ数を7色以内に抑えている
- [ ] 連続データにはViridis系（知覚的均一）を使っている
- [ ] `jet`/`rainbow` など非単調スケールを使用していない
- [ ] 発散データの中央点を白または淡色にしている

**色覚異常対応**
- [ ] 岡部・伊藤スケールまたはColorBrewer安全パレットを採用している
- [ ] 赤と緑だけで重要な区別をしていない
- [ ] CVDシミュレーター（Coblis等）でチェックしている
- [ ] グレースケール変換で値の単調性を確認した

**冗長エンコーディング**
- [ ] 色だけでなく形・パターン・ラベルでも情報を伝えている
- [ ] 直接ラベリングまたは近接凡例で色との照合コストを下げている
- [ ] 小さな視覚要素（細い線・小さな点）のコントラストを強化している
