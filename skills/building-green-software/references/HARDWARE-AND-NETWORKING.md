# HARDWARE-AND-NETWORKING.md

ハードウェアとネットワーキングにおけるグリーンソフトウェアエンジニアリング。

---

## 1. エンボディドカーボン（Embodied Carbon）

### 定義

ハードウェアデバイスには、製造・輸送・廃棄の過程で既に支払われたカーボンコストが存在する。これを**エンボディドカーボン（embodied carbon）**と呼ぶ。

### スマートフォンの場合

- **製造コストが年間カーボンフットプリントの85-95%を占める**
- 米国の平均世帯は22台の接続デバイスを所有（Deloitte 2022年調査）
- スマートフォンの寿命は2-3年程度
- 集積回路（integrated circuits）が最大のエミッション源

### サーバーの場合

- クラウドプロバイダーのサーバー寿命は4-6年
  - Microsoft: 4年→6年に延長（2022年7月）
  - Alphabet: 6年に変更（2023年1月）
  - AWS: 5年に変更（2022年1月）

### エンボディドカーボンコストのデータソース

- Green Software FoundationのSoftware Carbon Intensity (SCI) Guidance project
- 各種デバイスのエンボディドカーボンデータセットを提供

### ソフトウェア開発者にできること

1. **デバイスの寿命延長**: ハードウェアの利用期間を延ばす
2. **ハードウェアの利用率向上**: 同じハードウェアでより多くの処理を実行

---

## 2. デバイスロンジェビティ（Device Longevity）

### デバイス寿命の現状

| デバイスタイプ | 平均寿命 | 備考 |
|--------------|---------|------|
| スマートフォン | 2-3年 | 年1回の新モデルリリース（Apple等） |
| ゲーム機 | 7年サイクル | Xbox Oneは10年設計 |
| クラウドサーバー | 4-6年 | 財務上の期待寿命 |

### 寿命を決定する要因

1. **消費者の需要**
   - より薄いデバイス
   - 長いバッテリー寿命
   - 高性能

2. **Moore's law（ムーアの法則）**
   - 2年ごとにトランジスタ数が倍増
   - 新機能追加により古いデバイスでアプリが動作しにくくなる
   - GPU、ML専用チップ、メモリ増加等の進化

3. **ハードウェア故障**
   - 機械的故障（より頻繁）
   - 電気的故障

### グリーン開発の原則

**10年ルール**: デバイスは10年間使用可能であるべき

- ハードウェア製造者に長寿命設計を求める
- Fairphoneの例: モジュラー・修理可能なスマートフォンの販売増加（2018年23,000台→2022年120,000台）

---

## 3. ソフトウェア定義の陳腐化（Software-Defined Obsolescence）

### 定義

デバイスへのサポート（アップデート・アップグレード・修正）が終了することで発生する陳腐化。

### 3つのシナリオ

1. **デバイス製造者によるサポート終了**
   - Apple: iOS 15で6年前の端末までサポート
   - Android: Google/Samsung/Qualcommが4年のセキュリティアップデート、Googleは一部Pro端末で5年
   - セキュリティサポート終了後は買い替えが推奨される

2. **重要ソフトウェアのサポート終了**
   - ユーザーの主要ソフトウェアが動作しなくなる
   - 動作している端末を廃棄させる原因となる

3. **追加ソフトウェアのサポート終了**
   - 重要度は低いが、影響は存在

### グリーンソフトウェアの責任

**後方互換性（backward compatibility）の確保が最もグリーンな選択**

- 動作中のデバイスを廃棄させる原因にならない
- ソフトウェアがハードウェア廃棄の理由になることを回避

### 後方互換性の実装ガイド（Android例）

- **新APIの抽象化（Abstract the new APIs）**
- **新APIへのプロキシ（Proxy to the new APIs）**
- **古いAPIでの実装作成（Create an implementation with older APIs）**
- **バージョン対応コンポーネントの使用（Use the version-aware component）**

### 実装コスト

- 幅広いハードウェアバージョン対応はメンテナンスとテストコストを増加させる
- しかし、動作中のデバイスを延命できる価値は大きい

---

## 4. クラウド vs セルフホストデータセンター

### クラウドアプリケーションの効率

**クラウドプロバイダーが効率的な理由:**

- ハイパースケールクラウドは従来のデータセンターより効率的
- クラウドビジネスが主事業のため、効率化に多大な投資
- 他の業種（例: 小売業）は効率化に投資する余裕が少ない

### クラウドの効率を活かす

**エネルギー比例性（energy proportionality）の活用:**

- クラウド規模での効率はステロイド級
- 低利用率リソースはPUE（Power Usage Effectiveness）と運用コストが大幅増加
- 過剰なリソース予約は新規データセンター建設を促進→エンボディドカーボン増加

**具体例: AWS Graviton**

- AWS専用のArm64プロセッサ
- 同等のnon-Gravitonインスタンスと比較して60%エネルギー削減
- 設定変更のみで実現可能

### セルフホストデータセンターの最適化

**自社データセンターを持つ利点:**

1. **ハードウェア寿命の完全コントロール**
   - 例: 4年→5年延長で年間エンボディドカーボンコストが20%削減
     - 4,000 kg CO₂e ÷ 4年 = 1,000 kg/年
     - 4,000 kg CO₂e ÷ 5年 = 800 kg/年

2. **電圧チューニング（voltage tuning）**
   - Ohmの法則: P = V × I（電力 = 電圧 × 電流）
   - 低電圧 → 低エネルギー消費
   - ライフサイクル全体でチューニングが必要（専門知識必須）

3. **オフボタンの制御**
   - ピーク需要外の時間帯にハードウェアをシャットダウン
   - リスク: 突然の需要増加、起動時の故障
   - 持続可能性の観点では正しいリスク（Debra Bernstein, Intel）

### ハードウェア故障からの学び

- 機械的ディスク故障が頻繁な場合、ディスク書き込み頻度を減らすソフトウェア変更を検討
- Intelの「odometer」チップ: 故障リスク部分を停止し、残りを稼働

---

## 5. 特殊ハードウェア（Specialized Hardware）

### 定義

- ASIC（Application-Specific Integrated Circuits）
- FPGA（Field Programmable Gate Arrays）
- TPU（Tensor Processing Units）

### 汎用 vs 特殊ハードウェアの判断基準（Debra Bernstein, Intel）

**特殊ハードウェアが適している場合:**

- 問題領域を深く理解している
- ハードウェア利用率を最大化できる
- エネルギー使用効率が高い
- 長期間使用予定→エンボディドカーボンの観点で持続可能

**汎用ハードウェアが適している場合:**

- 問題領域が汎用的または新規
- 将来的に別の問題領域に転用可能→寿命延長→エンボディドカーボンの効率向上
- 短期的なエネルギー効率改善が長期的なエンボディドカーボンコストを上回らない可能性

### 具体例: ブロック暗号（Block Ciphers）

- TLS（Transport Layer Security）等で使用
- ASICはCPUよりも高速かつ安価

### Jevonsパラドックスの注意

- 効率化 → コスト低下 → 使用量増加
- 初期AI応用（画像処理）の例: チップの効率化 → 処理増加 → チップ生産増加 → エンボディドカーボン増加
- 効率改善がエンボディドカーボン削減と同等にならない

---

## 6. e-waste（電子廃棄物）

### 現状

- **世界で最も急成長している廃棄物流**
- 2019年: 5,000万トン（全商用航空機の総重量、またはシロナガスクジラ25万頭分）
- 2050年予測: 1億2,000万トン

### 環境への影響

1. **リサイクル率の低さ**
   - 2019年: 正式リサイクルは20%のみ
   - 金・プラチナ・コバルト等の貴重な材料が含まれる

2. **非公式リサイクルの危険性**
   - 主に発展途上国で実施
   - 鉛・カドミウム・水銀・ヒ素等の有害物質を含む
   - 環境・労働者への健康リスク

3. **エンボディドカーボン増加**
   - 廃棄デバイスはすぐに新品に置き換えられる
   - スマートフォン製造コストが年間カーボンフットプリントの85-95%

### IoTとスマートホームの影響

- 従来「ダム」だったデバイス（冷蔵庫・TV・洗濯機）がスマート化
- アプリ機能のために動作中の食洗機を廃棄→e-waste増加
- ソフトウェア開発者の責任範囲が拡大

### 解決策

**個人レベル:**
- 自分のデバイスを長く使う
- 顧客が同様にできるようにする

**政府レベル:**
- EU: 修理する権利提案（2023年3月、欧州議会承認済）
- ニューヨーク州: 電子機器修理義務法（2022年12月、米国初）
- インド: e-waste管理規則（2023年4月施行）

**業界レベル:**
- ジャンクヤードデータセンター: 廃棄スマートフォンを計算資源として再利用（特定ワークロードでグリーンかつ安価）
- サーバー・機器のセカンドハンド市場: コストとエンボディドカーボン両方を削減

### ハードウェア生産者の取り組み

**TSMC（Taiwan Semiconductor Manufacturing Company）:**
- 2030年までに単位生産あたりGHG排出を40%削減
- 再生可能エネルギー使用拡大
- 2016-2030年で累積5,000 GWh省エネ

**Intel:**
- 2030年目標: ネットポジティブ水使用、埋立廃棄物ゼロ、100%再生可能電力
- 2040年: Scope 1/2でネットゼロ
- Intel Resale Corporation: e-waste最小化

**Arm:**
- 2030年までに全Scopeで排出を50%以上削減、ネットゼロ達成
- 100%再生可能エネルギー、エネルギー消費削減、カーボン除去プロジェクト投資

**Apple:**
- 2030年までに100%再生可能エネルギーで全製品製造
- リサイクル・再生可能素材の使用増加

**Microsoft:**
- 2030年までに全直接運営でゼロ廃棄物
- Surface/Xboxの再生品購入プログラム、リサイクルスキーム

---

## 7. ネットワーキングの基礎

### インターネットの構成要素

1. **ワイヤ（Wires）**: ファイバーケーブル、銅線、無線
2. **コンピュート（Compute）**: 推定1,000億CPU
3. **ストレージ（Storage）**: データ圧縮、トランスコーディング、キャッシング

### エネルギー効率の現状

- テレコム機器製造者は「watts per bit（ビットあたりのワット数）」を主要指標として継続的改善
- 電気代がネットワーク運用コストの大部分

### インターネットの3層構造

1. **Backbone（バックボーン）**
   - 長距離伝送
   - 海底ケーブル含む
   - 主にファイバーオプティック
   - 数百万ユーザーのパケットを伝送
   - **最も効率的**

2. **Metro（メトロ）**
   - 都市内伝送
   - 数千ユーザーのトラフィック
   - 通常ファイバーオプティック
   - **効率的**

3. **Last Mile（ラストマイル）**
   - 個々のユーザーへの配信
   - 銅線、ファイバー、無線（3G/4G/5G）、衛星（LEO）
   - 実際には50マイルまたは50フィート

### ワイヤの効率比較（ラストマイルで比較）

| 順位 | 技術 | 備考 |
|-----|-----|------|
| 1 | ファイバー | 最も効率的 |
| 2 | 銅線 | - |
| 3 | 5G | 4Gより大幅改善 |
| 4 | Wi-Fi | モバイルより効率的、有線より劣る |
| 5 | 4G | 3Gより効率的 |
| 6 | 3G | 最も非効率 |

**使い分け原則: 用途に最適なものを選択**

- 屋内・固定位置: Wi-Fi推奨（最も効率的）
- 屋外・移動中・干渉多い場所: モバイル接続必須
- 例: ロンドン地下鉄がWi-Fi→5Gに移行（全行程接続のため）

### データ圧縮とコンピュート

**トレードオフ判断:**

- 現代データセンター: ネットワーク機器は電気代の10%未満
- ファイバーネットワークは計算より効率的
- 非圧縮送信が有利な場合もある

**圧縮が推奨される場合:**
- データが高圧縮可能
- 送信がピーク時間
- ビデオコーデックチップ等の圧縮ハードウェアを利用可能

---

## 8. Border Gateway Protocol (BGP)

### BGPの役割

- インターネット上のパケットルーティングを制御
- 自律システム（Autonomous Systems）間の接続を管理
- 次のホップのみを決定（エンドツーエンドルートは計算しない）

### BGP決定要因

- 通過する自律システム数の最小化
- ポリシールールと商業的取り決め

### グリーンルーティングの課題

**なぜBGP変更が推奨されないか:**

1. **安定性リスク**
   - BGPはインターネットの最も脆弱な部分
   - 大規模障害の多くはBGP設定ミス
   - 複雑性追加は危険

2. **商業的インセンティブの複雑性**
   - 一部の自律システム: トラフィック増加を望む（収益源）
   - 一部の自律システム: トラフィック減少を望む（コスト削減）
   - グリーンルートがトラフィック増加を招く場合、インセンティブが不整合

3. **アプリケーションレベルの問題**
   - データセンター内でのマイクロサービス、ストレージメディア、冗長性等の非効率
   - BGP以前の問題が多数存在

**結論: アプリケーションレベルの改善が低コストかつ高インパクト**

---

## 9. ネットワークのグリーン化戦略

### 2020年ロックダウンからの教訓

**インターネットが50%需要増加に対応できた理由:**

- 新規インフラ構築なし
- 需要シフティング（demand shifting）とシェイピング（demand shaping）
- グレースフルダウングレード（graceful downgrades）

### ネットワークレベルのデマンドシフティング

**CDN（Content Delivery Networks）の役割:**

1. **プリキャッシング**
   - 大容量アセットを事前にCDNに配置
   - エンドユーザーには近距離から配信
   - ネットワーク負荷削減

2. **トランスコーディング**
   - デバイスに応じた解像度調整（スマホは低解像度、4Kテレビは高解像度）
   - トラフィック削減

3. **オフピーク時の伝送**
   - アセットをネットワークが静かな時間帯に配置
   - ピーク負荷の平準化
   - ネットワークエンボディドカーボンの利用率向上

4. **物理配送**
   - Netflix: CDNへの映画配送をトラック輸送
   - "Never underestimate the bandwidth of a station wagon full of tapes" (Andrew Tanenbaum)

### ブラウンアウト（Brownouts）とグレースフルダウングレード

**定義:**
- **ブラウンアウト**: 電力不足時のサービス品質低下（電球が暗くなる現象から命名）
- **グレースフルダウングレード**: 完全な故障ではなく、限定的な機能維持

**COVID時の実例:**

1. **Netflix**
   - EU地域でHD→SDに切り替え
   - 画質低下だがサービス継続
   - デマンドシェイピングの例

2. **ビデオ会議（Zoom等）**
   - QoS（Quality of Service）技術活用
   - 音声を優先（高品質必須、比較的安価）
   - 映像品質を動的調整（リソース集約的）
   - 背景フィルター・キトンフィルターでデータ削減

### 電力供給の変動性への対応

**ダイナミック料金（Dynamic Tariffs）:**

- 30分ごとに電力コストが変動
- 再生可能エネルギーは化石燃料より安価→グリーン電力が安価
- スペイン、EU、北米で既に導入済

**ソフトウェア設計への影響:**

- 電力を100%利用可能な前提から脱却
- 帯域幅や接続性と同様に扱う
- デマンドマネジメントとグレースフルダウングレード戦略の必要性

### インターネットの耐障害性

**なぜ2020年のパンデミックを乗り越えられたか:**

- インターネットは元々不完全（90%の信頼性）
- アプリケーションは既に障害処理機能を備えていた
- 100%→95%の信頼性移行より、90%→50%の方が容易

**教訓: Chaos Engineering的思考**

- 不完全なプラットフォームが信頼性と効率性を促進
- 電力供給にも同様のアプローチが必要

---

## 10. ネットワーキング実践ガイド

### 今すぐ始めるべきこと

1. **ダイナミック料金設計**
   - 全システムをダイナミック料金前提で設計

2. **プラットフォーム要件**
   - 依存するプラットフォームがダイナミック料金・停電・デマンドシフティング・シェイピングに対応していることを確認

3. **電力を100%利用可能と仮定しない**
   - 電力を帯域幅や接続性と同様に扱う
   - デマンドマネジメントとグレースフルダウングレード戦略を検討

4. **既存ツールの活用**
   - CDN
   - Spot instances
   - その他のデマンドシフティング・シェイピングツール

### スタック層別の戦略

**低レイヤー（ネットワーク層）:**
- 既に効率的
- BGP変更はリスクが高い

**高レイヤー（アプリケーション層）:**
- 改善余地が大きい（逆説的だが、スタックの上部が低コスト果実）
- デマンドシフティング・シェイピングの実例多数
- より安全かつ高速な実装が可能
