# レビューの問題点・遅延・抜け穴

## レビューの4つの問題パターン

### 1. 怠惰なレビュー（Lazy Reviews）

コードを十分に確認せずに承認するパターン。

#### LGTM症候群

「Looks Good To Me」の略だが、実際には内容を確認せずに承認するケース。

**症状**:
- PRを開いてから数秒でApprovedが届く
- レビューコメントがゼロで承認される
- 大きなPRが全くコメントなしにマージされる

**原因**:
- レビュアーの時間的プレッシャー
- 「自分のコードは後でレビューしてもらいたい」という暗黙の取引
- レビューの価値に対する認識不足

**対策**:
- PRテンプレートに必須確認チェックリストを設ける
- 最小コメント数ルール（ブロッキング0件でも「確認済み」コメントを要求）
- 最小承認者数（2名以上）ルールをTWAに明記する

#### バディシステム

特定の2人がお互いに無条件で承認し合う関係。

**症状**:
- 特定の2人のPRが必ずお互いに承認している
- レビューの内容が表面的で、重要な問題が見落とされている

**対策**:
- レビュアーのランダムアサインまたはローテーション導入
- CODEOWNERSで自動アサインする

#### チャット承認

PRのコメントではなく、Slackやチャットツールで承認を得る。

**症状**:
- 「Slackで確認してもらったからOK」という発言
- PRに正式な承認が記録されていない

**対策**:
- すべての承認はPRツール上で行うルールをTWAに明文化する
- チャットでの確認は「参考意見」であり正式な承認ではないと周知する

---

### 2. 意地悪なレビュー（Mean Reviews）

批判的・攻撃的なフィードバックで、受け取る側に不快感を与えるレビュー。

**症状**:
- 「なぜこんな実装をしたのか」という詰問形式のコメント
- 「これはひどい」「読めない」等の感情的な表現
- 改善案なしの批判
- 個人の能力への言及（「こんな基本的なことも知らないのか」等）

**原因**:
- レビュアーのストレス・フラストレーション
- コードを通じて著者を批判することへの無自覚
- レビュー文化の規範がない

**対策**:
- TWAにトーンのガイドラインを含める（→ EFFECTIVE-COMMENTS.md 参照）
- コメントシグナルと3原則（客観性・具体性・アウトカム）を導入する
- 問題のあるコメントをチームで安全に指摘できる文化を作る
- 「ドライレビュー」の習慣: 感情的になっている場合は一晩おいてから送信する

**影響**:
意地悪なレビューを受け続けると、著者がPRを出すことを恐れるようになる。小さな変更を積み上げて大きなPRになる、レビュー依頼を遅らせる、チームへの帰属意識が低下するという悪循環を生む。

---

### 3. 形変えレビュー（Shape-shifting Reviews）

承認後に新たな要求が追加され、PRがいつまでも終わらないパターン。

**症状**:
- 一度承認したにも関わらず新しい要求が追加される
- 毎回新しい観点の指摘が出る
- 「前回は言わなかったけど、実はこれも...」という形での積み上げ

**原因**:
- レビュアーが一度に全体を確認していない（細切れレビュー）
- コメントの優先度が不明瞭
- ブロッキング・ノンブロッキングの区別がない

**対策**:
- 最初のレビューで全指摘を一度に出す（細切れ送信の禁止をTWAに記載）
- コメントシグナルとMoSCoWでブロッキング/非ブロッキングを明示する
- TWAで「Re-review依頼後の新規ブロッキングコメント禁止」ルールを設ける
  - 例外: Re-review時に新たなバグ・セキュリティ問題が発見された場合

---

### 4. 過剰厳格なレビュー（Stringent Reviews）

完璧主義的な基準でコードを評価し、承認を与えないレビュー。

**症状**:
- PRが何週間も承認されない
- 小さな改善ごとに新しいブロッキング指摘が出る
- 「もっと良くなる」という理由で無限に修正を要求する
- リファクタリングや将来的な改善をすべてブロッキングとして扱う

**原因**:
- 完璧主義的な傾向
- 「Good enough」の基準がチームで共有されていない
- 「承認 = 自分の評価」という誤解（承認したコードのバグが自分の責任になるという恐れ）

**対策**:
- ブロッキング基準を明文化し、基準外のことはノンブロッキングとして扱う
- 「完璧なコードではなく、動作する良いコードを届ける」という価値観を共有する
- 「出荷したコードは後で改善できる」という考え方を取り入れる
- レビュアーの責任範囲を明確化する（承認=全責任ではない）

---

## レビューの6つの遅延原因

### 1. シニア開発者へのボトルネック依存

**症状**: 特定の一人がすべてのPRをレビューしないとマージできない状態。

**影響**: その人が休暇・病欠・多忙になると開発が完全に止まる。

**対策**:
- レビュー能力のあるメンバーを育成する（`levelup:` コメントの積極活用）
- CODEOWNERSで特定領域の専門家を設定しつつ、他のメンバーも承認できるようにする
- 上席者必須のルールは本当に必要な領域のみに限定する
- レビューローテーションで特定個人への依存を構造的に分散させる

### 2. PRの目的が不明瞭

**症状**: レビュアーがコードを読んでも何を変えているのかわからない。

**影響**: レビュアーが変更の意図を理解するのに時間がかかり、間違った指摘をする可能性がある。

**対策**:
- PRテンプレートでタイトル・説明文の記載を強制する
- 「What（何を変えたか）」と「Why（なぜ変えたか）」を必須項目とする
- PRテンプレートの記載が不十分な場合は、レビュー前に補足を求める

### 3. PRが大きすぎる

**症状**: 1つのPRで数十ファイル・数千行の変更がある。

**影響**: レビュアーの集中力が持たず、レビュー時間が長くなり、問題を見落とす。

**対策**:
- PRサイズ上限をTWAに明記する（20ファイル・500行目安）
- 大きなPRはフィーチャーフラグで機能を無効化しつつ、レイヤーごとに分割する
- PRサイズチェッカーを導入し、超過したPRに自動警告を表示する
- 「大きなPRを分割してほしい」と依頼することはレビュアーの権利と認識する

### 4. 大機能の一括開発

**症状**: 機能全体が完成してから一度に大きなPRを出す。

**影響**: 設計の問題が遅くに発覚し、大幅な手戻りが発生する。設計変更の可能性がある時点でのフィードバックが最も価値が高い。

**対策**:
- 設計段階でRFC（Request for Comments）やドラフトPRを出す習慣を作る
- 実装を小さなPRに分割してインクリメンタルにレビューを受ける
- 「PRを出す前に実装を完成させる」という考え方を変える

### 5. PRでの過剰な議論

**症状**: コメント欄で長い設計議論が続き、PRが進まない。

**影響**: 議論が散漫になり、コードレビューが設計ミーティングに変わる。

**対策**:
- PRのコメントは「小さなコード改善」の議論に限定する
- 設計上の大きな意見の相違は、別途同期的な議論（MTG）に切り出す
- 「3往復ルール」: コメントのやり取りが3往復を超えたら口頭で解決する
- 決定事項はPRコメントに記録することで、議論の流れを残す

### 6. 繰り返しリファクタリング要求

**症状**: レビューのたびに新しいリファクタリング要求が出て、作業が終わらない。

**影響**: 著者が疲弊し、レビューへのモチベーションが低下する。

**対策**:
- リファクタリング提案は `nitpick:` または `suggestion:` でノンブロッキングとして扱う
- 「このPRのスコープ内で対応すべきか」を判断基準にする
- 技術的負債は計画的に返済する（リファクタリングスプリントの設定等）

---

## プロセスの6つの抜け穴

### 1. プロセスが未定義

**問題**: コードレビューのルールが存在しないか、曖昧なまま。

**影響**: メンバーごとにレビューのやり方が違い、品質が安定しない。期待のズレがストレスを生む。

**対策**: TWAを作成し、チームで合意する。完璧なルールを作ろうとせず、まず最小限のルールを試す。

### 2. 時間不足

**問題**: 「忙しくてレビューする時間がない」という状態が常態化している。

**影響**: レビューの質が低下し、問題が見落とされる。レビュー待ちのPRが積み上がる。

**真の原因**: 多くの場合、PRが大きすぎることが本当の原因。大きなPRは大きな時間を要求する。

**対策**:
- PRを小さくする（PRが小さければレビューに時間がかからない）
- レビュー時間を明示的にスケジュールに組み込む
- 「レビューは開発作業の一部」という認識を持つ

### 3. ツールの設定ミス

**問題**: CI/CDや自動チェックが正しく設定されていない。

**影響**: 問題のあるコードが自動的に弾かれず、レビュアーに人力対応が集中する。

**対策**:
- Linter・フォーマッター・テストの自動実行をCIに組み込む
- PRマージ条件にCIパスを設定する（必須のgateを設ける）
- ツールの設定をコードベースに含め、チーム全員が同じ設定を使う

### 4. フィードバック文化の欠如

**問題**: 批判的なフィードバックを与えること・受け取ることへの心理的障壁が高い。

**影響**: 問題を指摘せずにスルーする、または必要以上に遠慮したコメントになる。

**対策**:
- コードレビューの目的を「コードの改善」であり「個人評価」ではないとチームで共有する
- 心理的安全性を高める取り組みを継続する
- TWAでポジティブなフィードバック（称賛）の文化を明示する
- コメント技法の研修・勉強会を実施する

### 5. 承認メトリクス偏重

**問題**: 「レビューした数」や「承認した数」が評価指標になっている。

**影響**: 質より量を重視した表面的なレビューが増える（LGTM症候群を加速する）。

**対策**:
- 量ではなく質を重視する（発見したバグ数、コメントの有用性等）
- そもそもレビュー件数を個人の評価指標にしない
- チームの総合的なコード品質指標（バグ発生率、後戻り発生率等）で評価する

### 6. 緊急対応の乱用

**問題**: 「緊急」という名目でレビューをスキップすることが常態化している。

**影響**: 緊急対応が緊急でないものにも適用され、レビュープロセスが形骸化する。

**対策**:
- 緊急の定義を明文化し、適用条件を限定する（→ REVIEW-PROCESS.md 参照）
- 緊急対応の件数を月次で集計・チームに報告する
- 事後レビューを必ず実施し、その記録を残す
- 権限者（承認できる人）を事前に限定し、乱用を構造的に防ぐ

---

## アンチパターン診断チェックリスト

チームのレビュープロセスを診断する際に使用する。

**レビューの質に関する問題**:
- [ ] コメントゼロの承認が頻発している → LGTM症候群
- [ ] 特定の2人が常にお互いを承認している → バディシステム
- [ ] コメントの言い回しが攻撃的だという声がある → 意地悪レビュー
- [ ] 承認後に新たなブロッキング要求が繰り返し出る → 形変えレビュー
- [ ] PRが2週間以上承認されないケースがある → 過剰厳格または遅延

**プロセスの問題**:
- [ ] レビュー待ちのPRが常に積み上がっている → ボトルネック or 時間不足
- [ ] 1つのPRに何十もの議論コメントがある → PRでの過剰議論
- [ ] 「緊急」でマージされるPRが月に複数ある → 緊急対応の乱用
- [ ] レビューのルールが人によって違う → プロセス未定義

→ 該当する項目があれば、対応する対策セクションを参照する。
